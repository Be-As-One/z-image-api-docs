---
title: Error Handling
description: 'Handle errors based on message, not error codes'
---

## Error Response Format

All API responses follow this format:

```json
{
  "code": 400,
  "message": "Invalid prompt content",
  "data": null
}
```

**The `message` field tells you what went wrong.** You don't need to memorize error codes.

## Common Error Messages

| message | What it means | What to do |
|---------|---------------|------------|
| `Missing Authorization header` | No API key provided | Add `Authorization: Bearer YOUR_API_KEY` header |
| `Invalid API Key` | Wrong API key | Check your API key in dashboard |
| `API Key is inactive` | Key disabled | Reactivate key in dashboard |
| `API Key has expired` | Key expired | Generate new API key |
| `Insufficient credits` | Not enough credits | Add credits to your account |
| `Invalid request parameters` | Missing or wrong parameters | Check required fields |
| `Invalid inputs for model` | Wrong parameter values | Verify parameter types and values |
| `Task not found` | Invalid task ID | Check task ID or it may belong to another account |
| `Internal server error` | Server issue (temporary) | Retry after a few seconds |

## Task Failure States

When polling task status, the `state` field shows task progress:

- `waiting` - Task queued
- `generating` - Processing in progress
- `success` - Completed, check `resultJson` for result URLs
- `fail` - Failed, check `failMsg` for details

### Common Failure Messages

| failMsg | What to do |
|---------|------------|
| `Invalid prompt content` | Modify your prompt (may contain prohibited content) |
| `Image URL not accessible` | Ensure input image URL is publicly accessible |
| `Processing timeout` | Retry with same parameters |
| `Model temporarily unavailable` | Try again later or use different model |

## Basic Error Handling

```javascript
try {
  const response = await fetch('https://z-image.vip/api/v1/jobs/createTask', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${process.env.Z_IMAGE_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      model: 'z-image-turbo',
      inputs: { prompt: 'A sunset' }
    })
  });

  const data = await response.json();

  if (data.code !== 200) {
    console.error('Error:', data.message);
    throw new Error(data.message);
  }

  return data.data.taskId;

} catch (error) {
  console.error('Failed:', error.message);
  throw error;
}
```

## Simple Retry Logic

Retry on server errors (500) or rate limits (429):

```javascript
async function createTaskWithRetry(model, inputs, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch('https://z-image.vip/api/v1/jobs/createTask', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${process.env.Z_IMAGE_API_KEY}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ model, inputs })
      });

      const data = await response.json();

      if (data.code !== 200) {
        throw { code: data.code, message: data.message };
      }

      return data.data;

    } catch (error) {
      // Retry on server errors
      if ((error.code >= 500 || error.code === 429) && i < maxRetries - 1) {
        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      throw error;
    }
  }
}
```

## When to Retry

**DO retry:**
- `500` - Internal server error (temporary)
- `429` - Rate limit (wait and retry)
- Network timeouts

**DON'T retry:**
- `400` - Bad request (fix your parameters first)
- `401` - Unauthorized (check your API key)
- `402` - Insufficient credits (add credits first)
- `404` - Not found (task doesn't exist)

## Complete Example

```javascript
async function generateImage(prompt) {
  try {
    // 1. Create task with retry
    const task = await createTaskWithRetry('z-image-turbo', {
      prompt,
      resolution: '2k',
      aspectRatio: '16:9'
    });

    console.log('Task created:', task.taskId);

    // 2. Poll for completion
    const result = await pollTask(task.taskId);

    return result.resultUrls;

  } catch (error) {
    console.error('Generation failed:', error.message);

    // Handle specific errors
    if (error.message === 'Insufficient credits') {
      console.error('Please add credits at https://z-image.vip/admin');
    }

    throw error;
  }
}

async function pollTask(taskId, timeout = 300000) {
  const startTime = Date.now();
  const pollInterval = 3000; // 3 seconds

  while (Date.now() - startTime < timeout) {
    const response = await fetch(
      `https://z-image.vip/api/v1/jobs/recordInfo?taskId=${taskId}`,
      {
        headers: {
          'Authorization': `Bearer ${process.env.Z_IMAGE_API_KEY}`
        }
      }
    );

    const data = await response.json();

    if (data.code !== 200) {
      throw new Error(data.message);
    }

    const status = data.data;

    if (status.state === 'success') {
      return JSON.parse(status.resultJson);
    }

    if (status.state === 'fail') {
      throw new Error(status.failMsg || 'Generation failed');
    }

    // Still waiting/generating
    await new Promise(resolve => setTimeout(resolve, pollInterval));
  }

  throw new Error('Task timeout');
}
```

## Tips

<AccordionGroup>
  <Accordion title="Validate inputs before API calls">
    Catch errors early to avoid wasting credits:
    ```javascript
    if (!prompt || prompt.length < 3) {
      throw new Error('Prompt too short');
    }
    if (!['1k', '2k', '4k'].includes(resolution)) {
      throw new Error('Invalid resolution');
    }
    ```
  </Accordion>

  <Accordion title="Set timeouts for polling">
    Don't poll forever. Set a reasonable timeout (5-10 minutes).
  </Accordion>

  <Accordion title="Log errors with context">
    Include task ID and model when logging errors:
    ```javascript
    console.error('Task failed:', {
      taskId,
      model,
      error: error.message
    });
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Webhooks" icon="webhook" href="webhooks">
    Get notified when tasks complete (no polling needed)
  </Card>
  <Card title="API Reference" icon="book" href="reference/api-overview">
    Full API documentation
  </Card>
</CardGroup>
